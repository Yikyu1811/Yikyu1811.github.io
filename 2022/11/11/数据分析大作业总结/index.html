<!DOCTYPE html><html lang="zn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>数据分析大作业总结 | yikyuの杂货铺</title><script>var config = {"root":"/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 共 $1 行","copy":"复制","copyFinish":"完成","expand":"展开"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><script>mermaid.initialize({
 startOnLoad: true
 , theme: 'dark'
});</script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@11.6.0/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="generator" content="Hexo 6.2.0"></head><body style="background-image:url(/img/001.jpg);"><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><ol class="navContent"><li class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></li><li class="navItem"><a class="navBlock" href="/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav><div class="search-popup"><div id="search-result"></div></div></header><article><div id="post-bg"><div id="post-title"><h1>数据分析大作业总结</h1><div id="post-info"><span>First Post: <div class="control"><time datetime="2022-11-11T14:19:31.000Z" id="date"> 2022-11-11</time></div></span><br><span>Last Update: <div class="control"><time datetime="2022-11-15T03:57:32.098Z" id="updated"> 2022-11-15</time></div></span></div></div><hr><div id="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>主要是记录一下自己在大作业期间学习pandas库和数据图表的问题和解决方式</p>
<h1 id="一些分析"><a href="#一些分析" class="headerlink" title="一些分析"></a>一些分析</h1><p>数据分析的要点主要有：批量读取文件，数据的合并，数据的分析和输出</p>
<h2 id="批量读取文件和数据的合并"><a href="#批量读取文件和数据的合并" class="headerlink" title="批量读取文件和数据的合并"></a>批量读取文件和数据的合并</h2><p>首先获得文件路径和文件列表，依次将其组合后再进行合并操作，之后就可以使用循环读取文件数据了。<br>其中要解决文件表头统一的问题，因为合并时不能对空表进行合并所以要先对第一个文件进行读取之后从第二个文件开始循环。<br><label style="color:red">注意：pandas库在处理大量数据时，一旦超过设置显示上限会出现缩略表格，这个缩略表格会被直接存入默认的list列表中，因此要全程使用pandas库的表格进行操作，不然会出现大量的数据丢失。</label></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">import pandas as pd<br>import os<br>path=&#x27;babynames/&#x27;<br>filelist=os.listdir(path)<br>main=[]<br>for i in filelist:<br>    filepath=os.path.join(path,i)<br>    data=pd.DataFrame(pd.read_csv(filepath))<br>    main.append(data)<br>dfall=pd.DataFrame(main)<br>print(dfall)<br>dfall.to_csv(&#x27;a.txt&#x27;)<br></code></pre></td></tr></table></figure>
<p>输出结果：</p>
<img src="/2022/11/11/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%A4%A7%E4%BD%9C%E4%B8%9A%E6%80%BB%E7%BB%93/%E9%94%99%E8%AF%AF%E8%BE%93%E5%87%BA.png" class="" title="asd">
<p><label style="color:red">循环错误，不能使用int i进行计数循环例如：</label></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">for i in (1,len(filelist)-1):<br></code></pre></td></tr></table></figure>
<p><label style="color:red">会出数据大面积丢失，只会保留第一次和最后一次循环的数据<br>&#x2F;&#x2F;暂时还没有排查到原因，可能是和for循环中的自动计数有关：</label><br>错误实例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plaintext"># %%<br>import pandas as pd<br>import os<br>path=&#x27;babynames1/&#x27;<br>filelist=os.listdir(path)<br>t = [&#x27;姓名&#x27;, &#x27;性别&#x27;, &#x27;人数&#x27;]<br>main=pd.DataFrame(pd.read_csv(&#x27;babynames/yob1880.txt&#x27;,index_col=0,header=None,names=t))<br>for i in (1,len(filelist)-1):<br>    filepath=os.path.join(path,filelist[i])<br>    data=pd.DataFrame(pd.read_csv(filepath,index_col=0,header=None,names=t))<br>    main=pd.concat([main,data])<br># %%<br>main<br></code></pre></td></tr></table></figure>
<img src="/2022/11/11/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%A4%A7%E4%BD%9C%E4%B8%9A%E6%80%BB%E7%BB%93/%E5%9B%BE%E7%89%872.png" class="" title="asd"> 
<img src="/2022/11/11/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%A4%A7%E4%BD%9C%E4%B8%9A%E6%80%BB%E7%BB%93/%E5%9B%BE%E7%89%873.png" class="" title="asd">
<p>实际数据集</p>
<img src="/2022/11/11/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%A4%A7%E4%BD%9C%E4%B8%9A%E6%80%BB%E7%BB%93/%E5%9B%BE%E7%89%874.png" class="" title="asd">
<p>错误验证：<br>当文件只保留第一个第二个和最后一个的时候，结果和错误代码的输出一致</p>
<img src="/2022/11/11/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%A4%A7%E4%BD%9C%E4%B8%9A%E6%80%BB%E7%BB%93/%E5%9B%BE%E7%89%875.png" class="" title="asd"> 
<img src="/2022/11/11/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%A4%A7%E4%BD%9C%E4%B8%9A%E6%80%BB%E7%BB%93/%E5%9B%BE%E7%89%876.png" class="" title="asd">
<p>最后展示正确的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">#数据合并<br>import pandas as pd<br>import os<br>path=&#x27;babynames/&#x27;#设置默认文件夹路径<br>filelist=os.listdir(path)#读取文件列表<br>t = [&#x27;姓名&#x27;, &#x27;性别&#x27;, &#x27;人数&#x27;]#设置表头以便后续文件数据合并<br>main=pd.DataFrame(pd.read_csv(os.path.join(path,filelist[0]),index_col=0,header=None,names=t))#读取文件列表中的第一个文件<br>#其中index_col=0为取消索引,header=None为取消表头,names=t为添加表头<br>for i in filelist[1:]:#从第二个文件开始依次读取<br>    filepath=os.path.join(path,i)#将文件夹路径和文件名依次读取合并<br>    data=pd.DataFrame(pd.read_csv(filepath,index_col=0,header=None,names=t))#读取文件<br>    main=pd.concat([main,data])#将读取文件依次和总表合并<br>main.to_csv(&#x27;数据总和.txt&#x27;)<br>print(&#x27;数据合并完成&#x27;)<br><br></code></pre></td></tr></table></figure>
<h2 id="数据的分析和输出"><a href="#数据的分析和输出" class="headerlink" title="数据的分析和输出"></a>数据的分析和输出</h2><p>分析数据首先要对数据进行处理，其中最主要的数据的查询<br>Pandas库提供了对表格的查询功能<br>实例：<br>df[‘表头’]&#x3D;&#x3D;’查询内容’<br>查询可以进行嵌套或多条件查询<br>实例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">[(data[data[&#x27;性别&#x27;]==&#x27;M&#x27;].sum())[-1]]<br></code></pre></td></tr></table></figure>
<p>统计女性人数输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">((data[(data[&#x27;性别&#x27;]==&#x27;F&#x27;)&amp;(data[&#x27;姓名&#x27;]==&#x27;Mary&#x27;)].sum())[-1])<br></code></pre></td></tr></table></figure>
<p>多条件查询输出<br>数据分析<br>因为图表绘制时使用索引进行x轴，所以要获得一组与数据关联的数据作为主数据的索引，本次题目中文件名称中包含对应年份，因此对字符串进行拆分即可获得需要的索引<br>实例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">y=[filelist[0][3:7]]<br></code></pre></td></tr></table></figure>
<p>第一次读取文件列表时</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">y.append(filepath[-8:-4])<br></code></pre></td></tr></table></figure>
<p>在循环中由于出现路径拼接所以位置会发生变化（从末尾开始的话是一致的）<br>此外还在对数据分析时合并数据的过程中发现了数据出现混乱的情况，这类情况出现的原因是由于在读取数据时删除索引时会默认使用第一列作为索引导致不能对第一列数据进行查询操作，即出现第一列无表头的情况：</p>
<img src="/2022/11/11/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%A4%A7%E4%BD%9C%E4%B8%9A%E6%80%BB%E7%BB%93/%E5%9B%BE%E7%89%877.png" class="" title="asd">
<p>（1）：在读取文件时删除索引会导致无法进行合并的情况。<br>删除索引后会导致不能对名字进行查询操作<br>（2）：如果不删除索引则会发生重复的数据合并，索引中会出现很多条相同年份，但是在年份索引y的输出中是没有出现重复的。<br>排查后发现是因为循环中记录年份的追加导致临时list存储不止一行，然后转换为表格之后发生的填充。<br>因为作业截止时间问题所以在权衡之后决定按照之前的思路，考虑到最后输出数据集较小，采用list保存数据之后在最后进行合并。<br>最终实现代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">import pandas as pd<br>import os<br>import matplotlib.pyplot as plt<br>path=&#x27;babynames/&#x27;#设置默认文件夹路径<br>filelist=os.listdir(path)#读取文件列表<br>t = [&#x27;姓名&#x27;, &#x27;性别&#x27;, &#x27;人数&#x27;]#设置表头以便后续文件数据合并<br>y=[filelist[0][3:7]]#拆分文件名获得年份<br>maindata=pd.DataFrame(pd.read_csv(os.path.join(path,filelist[0]),header=None,names=t))#读取文件列表中的第一个文件<br>sexf=(maindata[maindata[&#x27;性别&#x27;]==&#x27;F&#x27;].sum())[-1]#女性总人数<br>main_m_p=&#123;&#x27;Mary&#x27;: ((maindata[(maindata[&#x27;性别&#x27;]==&#x27;F&#x27;)&amp;(maindata[&#x27;姓名&#x27;]==&#x27;Mary&#x27;)].sum())[-1])/sexf,&#x27;Anna&#x27;:\<br>((maindata[(maindata[&#x27;性别&#x27;]==&#x27;F&#x27;)&amp;(maindata[&#x27;姓名&#x27;]==&#x27;Anna&#x27;)].sum())[-1])/sexf&#125;<br>#查询Mary和Anna所占的百分比<br>maindataall=[]#创建空表存储数据结果，因为是小规模数据就用默认的list<br>maindataall.append(main_m_p)#追加至主数据集<br>for i in filelist[1:]:#从第二个文件开始依次读取<br>    filepath=os.path.join(path,i)#将文件夹路径和文件名依次读取合并<br>    data=pd.DataFrame(pd.read_csv(filepath,header=None,names=t))#读取文件<br>    sexf=(data[data[&#x27;性别&#x27;]==&#x27;F&#x27;].sum())[-1]#女性总人数<br>    data_m_p_s=&#123;&#x27;Mary&#x27;: ((data[(data[&#x27;性别&#x27;]==&#x27;F&#x27;)&amp;(data[&#x27;姓名&#x27;]==&#x27;Mary&#x27;)].sum())[-1])/sexf,&#x27;Anna&#x27;:\<br>    ((data[(data[&#x27;性别&#x27;]==&#x27;F&#x27;)&amp;(data[&#x27;姓名&#x27;]==&#x27;Anna&#x27;)].sum())[-1])/sexf&#125;<br>    maindataall.append(data_m_p_s) <br>    y.append(filepath[-8:-4])#追加年份到y中<br>a=pd.DataFrame(maindataall,index=y)<br>a.plot()#输出图表<br>plt.show()#显示图表<br></code></pre></td></tr></table></figure>
<p>输出：</p>
<img src="/2022/11/11/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%A4%A7%E4%BD%9C%E4%B8%9A%E6%80%BB%E7%BB%93/%E5%9B%BE%E7%89%878.png" class="" title="asd">
<p>附上第一个题目的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">import pandas as pd<br>import os<br>import matplotlib.pyplot as plt<br>path=&#x27;babynames/&#x27;#设置默认文件夹路径<br>filelist=os.listdir(path)#读取文件列表<br>t = [&#x27;姓名&#x27;, &#x27;性别&#x27;, &#x27;人数&#x27;]#设置表头以便后续文件数据合并<br>maindata=pd.DataFrame(pd.read_csv(os.path.join(path,filelist[0]),index_col=0,header=None,names=t))#读取文件列表中的第一个文件<br>sex_f_m = &#123;&#x27;M&#x27;:[(maindata[maindata[&#x27;性别&#x27;]==&#x27;M&#x27;].sum())[-1]],&#x27;F&#x27;:[(maindata[maindata[&#x27;性别&#x27;]==&#x27;F&#x27;].sum())[-1]]&#125;#统计获得男性和女性的总人数<br>#(maindata[maindata[&#x27;性别&#x27;]==&#x27;M&#x27;].sum())[-1]:查找表中的男性并统计计算不同名字的人数总和<br>maindata = pd.DataFrame(sex_f_m)<br>y=[filelist[0][3:7]]#拆分文件名获得年份<br>#其中index_col=0为取消索引,header=None为取消表头,names=t为添加表头<br>for i in filelist[1:]:#从第二个文件开始依次读取<br>    filepath=os.path.join(path,i)#将文件夹路径和文件名依次读取合并<br>    data=pd.DataFrame(pd.read_csv(filepath,index_col=0,header=None,names=t))#读取文件<br>    sex_f_m = &#123;&#x27;M&#x27;:[(data[data[&#x27;性别&#x27;]==&#x27;M&#x27;].sum())[-1]],&#x27;F&#x27;:[(data[data[&#x27;性别&#x27;]==&#x27;F&#x27;].sum())[-1]]&#125;<br>    sex_f_m_s = pd.DataFrame(sex_f_m)<br>    maindata=pd.concat([maindata,sex_f_m_s])#合并至主数据表中<br>    y.append(filepath[-8:-4])#追加年份到y中<br>maindata.index=y#将索引替换为年份<br>maindata.plot()#图表形式输出<br>plt.show()<br></code></pre></td></tr></table></figure>
<p>输出：</p>
<img src="/2022/11/11/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E5%A4%A7%E4%BD%9C%E4%B8%9A%E6%80%BB%E7%BB%93/%E5%9B%BE%E7%89%879.png" class="" title="asd"><div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/2022/11/22/blog-log-2022-11-22/">← Next blog-log-2022-11-22</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/2022/11/06/blog-log-2022-11-06/">blog-log-2022-11-06 Prev →</a></div></div></div></div><div id="bottom-btn"><a id="to-index" href="#toc-div" title="INDEX">≡</a><a id="to-top" onClick="scrolls.scrolltop();" title="to top" style="opacity: 0; display: none;">∧</a></div></article><aside><div id="aside-top"><div id="about"><a href="/" id="logo"><img src="/img/logo.png" alt="Logo"></a><h1 id="Dr"><a target="_blank" rel="noopener" href="https://github.com/Yikyu1811">Yikyu</a></h1><div id="description"></div></div><div id="aside-block"><div id="toc-div"><h1>INDEX</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">一些分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E5%92%8C%E6%95%B0%E6%8D%AE%E7%9A%84%E5%90%88%E5%B9%B6"><span class="toc-number">2.1.</span> <span class="toc-text">批量读取文件和数据的合并</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%9A%84%E5%88%86%E6%9E%90%E5%92%8C%E8%BE%93%E5%87%BA"><span class="toc-number">2.2.</span> <span class="toc-text">数据的分析和输出</span></a></li></ol></li></ol></div></div></div><footer><nobr><span class="text-title">ICP</span><a class="text-content" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">黔ICP备2022008629号-1</a></nobr><nobr><span class="text-title">©</span><span class="text-content">2022 to 2022</span></nobr><br><nobr>published with <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> Theme <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight</a></nobr><wbr><nobr>by <a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{code.findCode();mermaid.init(undefined, ('.mermaid'));}</script><script src="/js/arknights.js"></script><script>window.addEventListener("load",()=>{reset()})</script></body></html>